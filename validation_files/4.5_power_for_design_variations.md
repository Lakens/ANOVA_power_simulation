
``` r
knitr::opts_chunk$set(echo = TRUE)
nsims <- 10 #set number of simulations
library(mvtnorm)
library(MASS)
library(afex)
```

    ## Loading required package: lme4

    ## Loading required package: Matrix

    ## ************
    ## Welcome to afex. For support visit: http://afex.singmann.science/

    ## - Functions for ANOVAs: aov_car(), aov_ez(), and aov_4()
    ## - Methods for calculating p-values with mixed(): 'KR', 'S', 'LRT', and 'PB'
    ## - 'afex_aov' and 'mixed' objects can be passed to emmeans() for follow-up tests
    ## - NEWS: library('emmeans') now needs to be called explicitly!
    ## - Get and set global package options with: afex_options()
    ## - Set orthogonal sum-to-zero contrasts globally: set_sum_contrasts()
    ## - For example analyses see: browseVignettes("afex")
    ## ************

    ## 
    ## Attaching package: 'afex'

    ## The following object is masked from 'package:lme4':
    ## 
    ##     lmer

``` r
library(emmeans)
library(ggplot2)
library(gridExtra)
library(reshape2)
library(pwr)

# Install functions from GitHub by running the code below:
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/ANOVA_design.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/ANOVA_power.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/power_oneway_between.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/power_oneway_within.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/power_twoway_between.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/power_2x2_within.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/plot_power_oneway_between.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/plot_power_oneway_within.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/plot_power_twoway_between.R")
source("https://raw.githubusercontent.com/Lakens/ANOVA_power_simulation/master/helper_functions/plot_power_2x2_within.R")
```

Power for Design Variations
---------------------------

Researchers might consider what the effects on the statistical power of their design is, when they add participants. Participants can be added to an additional condition, or to the existing design.

In a One-Way ANOVA adding a condition means, for example, going from a 1x2 to a 1x3 design. For example, in addition to a control and intensive training condition, we add a light training condition.

``` r
string <- "2b"
n <- 50
mu <- c(80, 86) #All means are equal - so there is no real difference.
sd <- 10
r <- 0 
p_adjust = "none"
labelnames <- c("Condition", "control", "intensive_training") #

design_result <- ANOVA_design(string = string,
                   n = n, 
                   mu = mu, 
                   sd = sd, 
                   r = r, 
                   p_adjust = p_adjust,
                   labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-1.png)

``` r
# Power for the given N in the design_result
power_oneway_between(design_result)$power
```

    ## [1] 0.8438754

``` r
power_oneway_between(design_result)$Cohen_f
```

    ## [1] 0.3

``` r
power_oneway_between(design_result)$eta_p_2
```

    ## [1] 0.08256881

``` r
# Plot power curve (from 5 to 100)
plot_power_oneway_between(design_result,
                          max_n = 100)$p1
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-2.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-3.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-4.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-5.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-6.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-7.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-8.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-9.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-10.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-11.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-12.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-13.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-14.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-15.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-16.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-17.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-18.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-19.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-20.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-21.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-22.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-23.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-24.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-25.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-26.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-27.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-28.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-29.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-30.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-31.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-32.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-33.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-34.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-35.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-36.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-37.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-38.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-39.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-40.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-41.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-42.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-43.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-44.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-45.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-46.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-47.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-48.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-49.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-50.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-51.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-52.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-53.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-54.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-55.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-56.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-57.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-58.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-59.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-60.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-61.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-62.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-63.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-64.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-65.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-66.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-67.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-68.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-69.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-70.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-71.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-72.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-73.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-74.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-75.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-76.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-77.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-78.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-79.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-80.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-81.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-82.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-83.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-84.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-85.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-86.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-87.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-88.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-89.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-90.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-91.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-92.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-93.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-94.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-95.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-96.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-97.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-1-98.png)

``` r
ANOVA_power(design_result, nsims = nsims)
```

    ## Power and Effect sizes for ANOVA tests
    ##                 power effect size
    ## anova_Condition   100      0.0824
    ## 
    ## Power and Effect sizes for contrasts
    ##                                                  power effect size
    ## p_Condition_control_Condition_intensive_training   100      0.6536

We now addd a condition. Let's assume the 'light training' condition falls in between the other two means.

``` r
string <- "3b"
n <- 50
mu <- c(80, 83, 86) #All means are equal - so there is no real difference.
sd <- 10
r <- 0 
p_adjust = "none"
labelnames <- c("Condition", "control", "light_training", "intensive_training") 

design_result <- ANOVA_design(string = string,
                   n = n, 
                   mu = mu, 
                   sd = sd, 
                   r = r, 
                   p_adjust = p_adjust,
                   labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-1.png)

``` r
# Power for the given N in the design_result
power_oneway_between(design_result)$power
```

    ## [1] 0.7616545

``` r
power_oneway_between(design_result)$Cohen_f
```

    ## [1] 0.244949

``` r
power_oneway_between(design_result)$eta_p_2
```

    ## [1] 0.05660377

``` r
# Plot power curve (from 5 to 100)
plot_power_oneway_between(design_result,
                          max_n = 100)$p1
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-2.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-3.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-4.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-5.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-6.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-7.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-8.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-9.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-10.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-11.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-12.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-13.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-14.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-15.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-16.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-17.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-18.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-19.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-20.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-21.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-22.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-23.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-24.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-25.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-26.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-27.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-28.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-29.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-30.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-31.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-32.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-33.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-34.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-35.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-36.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-37.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-38.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-39.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-40.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-41.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-42.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-43.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-44.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-45.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-46.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-47.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-48.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-49.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-50.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-51.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-52.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-53.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-54.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-55.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-56.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-57.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-58.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-59.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-60.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-61.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-62.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-63.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-64.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-65.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-66.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-67.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-68.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-69.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-70.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-71.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-72.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-73.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-74.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-75.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-76.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-77.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-78.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-79.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-80.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-81.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-82.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-83.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-84.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-85.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-86.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-87.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-88.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-89.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-90.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-91.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-92.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-93.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-94.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-95.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-96.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-97.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-2-98.png)

We see that adding a condition that falls between the other two means reduces our power. Let's instead assume that the 'light training' condition is not different from the control condition. In other words, the mean we add is as extreme as one of the existing means.

``` r
string <- "3b"
n <- 50
mu <- c(80, 80, 86) #All means are equal - so there is no real difference.
sd <- 10
r <- 0 
p_adjust = "none"
labelnames <- c("Condition", "control", "light_training", "intensive_training") 

design_result <- ANOVA_design(string = string,
                   n = n, 
                   mu = mu, 
                   sd = sd, 
                   r = r, 
                   p_adjust = p_adjust,
                   labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-1.png)

``` r
# Power for the given N in the design_result
power_oneway_between(design_result)$power
```

    ## [1] 0.8762941

``` r
power_oneway_between(design_result)$Cohen_f
```

    ## [1] 0.2828427

``` r
power_oneway_between(design_result)$eta_p_2
```

    ## [1] 0.07407407

``` r
# Plot power curve (from 5 to 100)
plot_power_oneway_between(design_result,
                          max_n = 100)$p1
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-2.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-3.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-4.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-5.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-6.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-7.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-8.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-9.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-10.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-11.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-12.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-13.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-14.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-15.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-16.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-17.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-18.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-19.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-20.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-21.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-22.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-23.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-24.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-25.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-26.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-27.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-28.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-29.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-30.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-31.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-32.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-33.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-34.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-35.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-36.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-37.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-38.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-39.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-40.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-41.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-42.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-43.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-44.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-45.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-46.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-47.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-48.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-49.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-50.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-51.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-52.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-53.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-54.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-55.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-56.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-57.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-58.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-59.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-60.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-61.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-62.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-63.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-64.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-65.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-66.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-67.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-68.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-69.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-70.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-71.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-72.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-73.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-74.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-75.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-76.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-77.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-78.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-79.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-80.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-81.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-82.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-83.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-84.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-85.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-86.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-87.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-88.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-89.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-90.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-91.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-92.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-93.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-94.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-95.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-96.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-97.png)![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-3-98.png)

Now power has increased. This is not always true. The power is a function of many factors in the design, incuding the effect size (Cohen's f) and the total sample size (and the degrees of freedom and number of groups). But as we will see below, as we keep adding conditions, the power will reduce, even if initially, the power might increase.

It helps to think of these different designs in terms of either partial eta-squared, or Cohen's f (the one can easily be converted into the other).

``` r
#Two groups
mu <- c(80, 86)
sd = 10
n <- 50 #sample size per condition
mean_mat <- t(matrix(mu, 
                     nrow = 2,
                     ncol = 1)) #Create a mean matrix

# Using the sweep function to remove rowmeans from the matrix
mean_mat_res <- sweep(mean_mat,2, rowMeans(mean_mat))   
mean_mat_res
```

    ##      [,1] [,2]
    ## [1,]   -3    3

``` r
MS_a <- n * (sum(mean_mat_res^2)/(2-1))
MS_a
```

    ## [1] 900

``` r
SS_A <- n * sum(mean_mat_res^2)
SS_A
```

    ## [1] 900

``` r
MS_error <- sd^2
MS_error
```

    ## [1] 100

``` r
SS_error <- MS_error * (n*2) 
SS_error
```

    ## [1] 10000

``` r
eta_p_2 <- SS_A/(SS_A+SS_error)
eta_p_2
```

    ## [1] 0.08256881

``` r
f_2 <- eta_p_2/(1-eta_p_2)
f_2
```

    ## [1] 0.09

``` r
Cohen_f <- sqrt(f_2)
Cohen_f
```

    ## [1] 0.3

``` r
#Three groups
mu <- c(80, 83, 86)
sd = 10
n <- 50
mean_mat <- t(matrix(mu, 
                     nrow = 3,
                     ncol = 1)) #Create a mean matrix

# Using the sweep function to remove rowmeans from the matrix
mean_mat_res <- sweep(mean_mat,2, rowMeans(mean_mat))   
mean_mat_res
```

    ##      [,1] [,2] [,3]
    ## [1,]   -3    0    3

``` r
MS_a <- n * (sum(mean_mat_res^2)/(3-1))
MS_a
```

    ## [1] 450

``` r
SS_A <- n * sum(mean_mat_res^2)
SS_A
```

    ## [1] 900

``` r
MS_error <- sd^2
MS_error
```

    ## [1] 100

``` r
SS_error <- MS_error * (n*3) 
SS_error
```

    ## [1] 15000

``` r
eta_p_2 <- SS_A/(SS_A+SS_error)
eta_p_2
```

    ## [1] 0.05660377

``` r
f_2 <- eta_p_2/(1-eta_p_2)
f_2
```

    ## [1] 0.06

``` r
Cohen_f <- sqrt(f_2)
Cohen_f
```

    ## [1] 0.244949

The SS\_A or the sum of squares for the main effect, is 900 for two groups, and the SS\_error for the error term is 10000. When we add a group, SS\_A is 900, and the SS\_error is 15000. Because the added condition falls exactly on the grand mean (83), the sum of squared for this extra group is 0. In other words, it does nothing to increase the signal that there is a difference between groups. However, the sum of squares for the error, which is a function of the total sample size, is increased, which reduces the effect size. So, adding a condition that falls on the grand mean reduces the power for the main effect of the ANOVA. Obviously, adding such a group has other benefits, such as being able to compare the two means to a new third condition.

We already saw that adding a condition that has a mean as extreme as one of the existing groups also reduces the power. Let's again do the calculations step by step when the extra group has a mean as extreme as one of the two original conditions.

``` r
#Three groups
mu <- c(80, 80, 86)
sd = 10
n <- 50
mean_mat <- t(matrix(mu, 
                     nrow = 3,
                     ncol = 1)) #Create a mean matrix

# Using the sweep function to remove rowmeans from the matrix
mean_mat_res <- sweep(mean_mat,2, rowMeans(mean_mat))   
mean_mat_res
```

    ##      [,1] [,2] [,3]
    ## [1,]   -2   -2    4

``` r
MS_a <- n * (sum(mean_mat_res^2)/(3-1))
MS_a
```

    ## [1] 600

``` r
SS_A <- n * sum(mean_mat_res^2)
SS_A
```

    ## [1] 1200

``` r
MS_error <- sd^2
MS_error
```

    ## [1] 100

``` r
SS_error <- MS_error * (n*3) 
SS_error
```

    ## [1] 15000

``` r
eta_p_2 <- SS_A/(SS_A+SS_error)
eta_p_2
```

    ## [1] 0.07407407

``` r
f_2 <- eta_p_2/(1-eta_p_2)
f_2
```

    ## [1] 0.08

``` r
Cohen_f <- sqrt(f_2)
Cohen_f
```

    ## [1] 0.2828427

We see the sum of squares of the error stays the same - 15000 - because it is only determined by the standard error and the sample size, but not by the differences in the means. This is an increase of 5000 compared to the 2 group design. The sum of squares (the second component that determines the size of partial eta-squared) increases, which increases Cohen's f.

Within Designs
==============

Now imagine our design described above was a within design. The means and sd remain the same. We collect 50 participants (instead of 100, or 50 per group, for the between design). Let's first assume the two samples are completely uncorrelated.

``` r
string <- "2w"
n <- 50
mu <- c(80, 86) #All means are equal - so there is no real difference.
sd <- 10
r <- 0.0
p_adjust = "none"
labelnames <- c("Condition", "control", "intensive_training") #

design_result <- ANOVA_design(string = string,
                   n = n, 
                   mu = mu, 
                   sd = sd, 
                   r = r, 
                   p_adjust = p_adjust,
                   labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-6-1.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.8366436

We see power is ever so slightly less than for the between subject design. This is due to the loss in degrees of freedom, which is 2(n-1) for between designs, and n-1 for within designs. But as the correlation increases, the power advantage of within designs becomes stronger.

``` r
string <- "3w"
n <- 50
mu <- c(80, 83, 86) #All means are equal - so there is no real difference.
sd <- 10
r <- 0.0
p_adjust = "none"
labelnames <- c("Condition", "control", "light_training","intensive_training") #

design_result <- ANOVA_design(string = string,
                   n = n, 
                   mu = mu, 
                   sd = sd, 
                   r = r, 
                   p_adjust = p_adjust,
                   labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-7-1.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.7570841

When we add a a condition in a within design where we expect the mean to be identical to the grand mean, we again see that the power decreases. This similarly shows that adding a condition that equals the grand mean to a within subject design does not come for free, but has a power cost.

``` r
n <- 30
sd <- 10
r <- 0.5
p_adjust = "none"


string <- "2w"
mu <- c(0, 5) #All means are equal - so there is no real difference.
labelnames <- c("Factor_A", "a1", "a2") #
design_result <- ANOVA_design(string = string, n = n, mu = mu, sd = sd, r = r, 
                   p_adjust = p_adjust, labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-8-1.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.7539647

``` r
power_oneway_within(design_result)$Cohen_f
```

    ## [1] 0.25

``` r
power_oneway_within(design_result)$Cohen_f_SPSS
```

    ## [1] 0.5085476

``` r
power_oneway_within(design_result)$lambda
```

    ## [1] 7.5

``` r
power_oneway_within(design_result)$F_critical
```

    ## [1] 4.182964

``` r
string <- "3w"
mu <- c(0, 0, 5) #All means are equal - so there is no real difference.
labelnames <- c("Factor_A", "a1", "a2", "a3") #
design_result <- ANOVA_design(string = string, n = n, mu = mu, sd = sd, r = r, 
                   p_adjust = p_adjust, labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-8-2.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.7937037

``` r
power_oneway_within(design_result)$Cohen_f
```

    ## [1] 0.2357023

``` r
power_oneway_within(design_result)$Cohen_f_SPSS
```

    ## [1] 0.4152274

``` r
power_oneway_within(design_result)$lambda
```

    ## [1] 10

``` r
power_oneway_within(design_result)$F_critical
```

    ## [1] 3.155932

``` r
string <- "4w"
mu <- c(0, 0, 0, 5) #All means are equal - so there is no real difference.
labelnames <- c("Factor_A", "a1", "a2", "a3", "a4") #
design_result <- ANOVA_design(string = string, n = n, mu = mu, sd = sd, r = r, 
                   p_adjust = p_adjust, labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-8-3.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.7940126

``` r
power_oneway_within(design_result)$Cohen_f
```

    ## [1] 0.2165064

``` r
power_oneway_within(design_result)$Cohen_f_SPSS
```

    ## [1] 0.3595975

``` r
power_oneway_within(design_result)$lambda
```

    ## [1] 11.25

``` r
power_oneway_within(design_result)$F_critical
```

    ## [1] 2.709402

``` r
string <- "5w"
mu <- c(0, 0, 0, 0, 5) #All means are equal - so there is no real difference.
labelnames <- c("Factor_A", "a1", "a2", "a3", "a4", "a5") #
design_result <- ANOVA_design(string = string, n = n, mu = mu, sd = sd, r = r, 
                   p_adjust = p_adjust, labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-8-4.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.7838682

``` r
power_oneway_within(design_result)$Cohen_f
```

    ## [1] 0.2

``` r
power_oneway_within(design_result)$Cohen_f_SPSS
```

    ## [1] 0.3216338

``` r
power_oneway_within(design_result)$lambda
```

    ## [1] 12

``` r
power_oneway_within(design_result)$F_critical
```

    ## [1] 2.44988

``` r
string <- "6w"
mu <- c(0, 0, 0, 0, 0, 5) #All means are equal - so there is no real difference.
labelnames <- c("Factor_A", "a1", "a2", "a3", "a4", "a5", "a6") #
design_result <- ANOVA_design(string = string, n = n, mu = mu, sd = sd, r = r, 
                   p_adjust = p_adjust, labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-8-5.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.7699592

``` r
power_oneway_within(design_result)$Cohen_f
```

    ## [1] 0.186339

``` r
power_oneway_within(design_result)$Cohen_f_SPSS
```

    ## [1] 0.2936101

``` r
power_oneway_within(design_result)$lambda
```

    ## [1] 12.5

``` r
power_oneway_within(design_result)$F_critical
```

    ## [1] 2.276603

``` r
string <- "7w"
mu <- c(0, 0, 0, 0, 0, 0, 5) #All means are equal - so there is no real difference.
labelnames <- c("Factor_A", "a1", "a2", "a3", "a4", "a5", "a6", "a7") #
design_result <- ANOVA_design(string = string, n = n, mu = mu, sd = sd, r = r, 
                   p_adjust = p_adjust, labelnames = labelnames)
```

![](4.5_power_for_design_variations_files/figure-markdown_github/unnamed-chunk-8-6.png)

``` r
power_oneway_within(design_result)$power
```

    ## [1] 0.754601

``` r
power_oneway_within(design_result)$Cohen_f
```

    ## [1] 0.1749636

``` r
power_oneway_within(design_result)$Cohen_f_SPSS
```

    ## [1] 0.2718301

``` r
power_oneway_within(design_result)$lambda
```

    ## [1] 12.85714

``` r
power_oneway_within(design_result)$F_critical
```

    ## [1] 2.151016

This set of designs where we increase the number of conditions demonstrates a common pattern where the power initially increases, but then starts to decrease. Again, the exact pattern (and when the power starts to decrease) depends on the effect size and sample size. Note also that the effect size (Cohen's f) decreases as we add conditions, but the increased sample size compensates for this when calculating power. When using power analysis software such as GPower, this is important to realize. You can't just power for a medium effect size, and then keep adding conditions under the assumption that the increased power you see in the program will become a reality. Increasing the number of conditions will reduce the effect size, and therefore, adding conditions will not automatically increase power (and might even decrease it).

Overal, the effect of adding conditions with an effect close to the grand mean reduces power quite strongly, and adding conditions with means close to the extreme of the current conditions will either slightly increase of decrease power.
